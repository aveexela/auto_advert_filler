# Автозаполнение карточек товаров по изображениям одежды

## Постановка задачи

Цель проекта — построение мультимодального ML-пайплайна для автоматического
заполнения карточек товаров по изображениям одежды.

По входным изображениям необходимо:
- извлекать структурированные атрибуты товара;
- формировать нейтральное текстовое описание,
  опирающееся **только на визуально определимые признаки**,
  без галлюцинаций и недостоверных утверждений.

Проект охватывает полный цикл:
от сбора и подготовки данных
до экспериментальной реализации мультимодальной модели.

---

## Заполняемые поля карточки

В рамках проекта автоматически формируются:

- тип одежды;
- гендер (мужской / женский);
- цвет;
- краткое текстовое описание товара (2–3 предложения).

---

## Аудитория и применение

Проект ориентирован на задачи автоматизации работы с маркетплейсами
и классифайдами объявлений, в том числе:

- генерация черновиков карточек товаров;
- ускорение модерации контента;
- подготовка обучающих датасетов для мультимодальных моделей;
- исследование устойчивых подходов к генерации описаний
  при шумном исходном тексте.

---

## Архитектура решения

Проект реализован в виде двух Jupyter Notebook:

### `01_parser.ipynb`
- парсинг HTML-страниц объявлений;
- извлечение заголовка, категории, характеристик и описания;
- загрузка и сохранение изображений;
- формирование структурированного датасета в формате `jsonl`.

### `02_pipeline.ipynb`
- подготовка и очистка датасета;
- извлечение визуальных эмбеддингов изображений с помощью CLIP;
- обучение классификаторов структурных атрибутов;
- генерация текстовых описаний без галлюцинаций
  с использованием BLIP и LLM.

---

## Архитектура мультимодального пайплайна

```
HTML + изображения
↓
Парсер HTML
↓
Структурированный датасет (jsonl)
↓
CLIP-эмбеддинги изображений
↓
MLP-классификаторы атрибутов
↓
BLIP-captioning (визуальные наблюдения)
↓
LLM (генерация текста)
```
## Данные

В ходе работы был собран локальный датасет объявлений
с интернет-ресурса для размещения объявлений (Авито),
включающий HTML-страницы объявлений и изображения товаров.

HTML-страницы и изображения не опубликованы в репозитории
по причинам защиты прав правообладателя и большого объёма данных.

В репозитории доступны агрегированные результаты парсинга
в формате `jsonl`, содержащие:
- извлечённые структурированные поля объявлений;
- ссылки на оригинальные объявления;
- ссылки на изображения товаров.

---

## Метрики и результаты экспериментов

### Длина сгенерированных описаний

Для второго ноутбука (`02_pipeline.ipynb`) получены следующие значения:

- средняя длина описания: **142.0 символа**  
- минимальная длина: **41 символ**  
- максимальная длина: **301 символ**  
- пустые описания: отсутствуют  

Формат описаний соответствует заданному ограничению
(2–3 предложения, нейтральный стиль).

---

### Согласованность изображения и текста

Для оценки согласованности сгенерированных описаний и изображений
использовалась метрика **CLIPScore**.

- среднее значение: **0.205**  
- стандартное отклонение: **0.035**

Оценка проводилась на подвыборке тестовых объявлений.

---

### Классификация структурных атрибутов

#### Тип одежды

Accuracy: **0.902**  
Macro F1: **0.872**

| Класс       | Precision | Recall | F1-score |
|-------------|-----------|--------|----------|
| dress       | 0.708     | 0.739  | 0.723    |
| outerwear  | 0.978     | 0.957  | 0.968    |
| shoes      | 1.000     | 1.000  | 1.000    |
| skirt      | 0.708     | 0.739  | 0.723    |
| top        | 0.894     | 0.894  | 0.894    |
| trousers   | 0.935     | 0.915  | 0.925    |

---

#### Гендер

Accuracy: **0.833**  
Macro F1: **0.826**

| Класс | Precision | Recall | F1-score |
|-------|-----------|--------|----------|
| man   | 0.768     | 0.811  | 0.789    |
| woman| 0.878     | 0.847  | 0.862    |

---

#### Цвет

Accuracy: **0.603**  
Macro F1: **0.306**

Результаты по цвету отражают высокую сложность задачи,
дисбаланс классов и шум в исходных аннотациях.

---

## Генерация текстовых описаний

Используется поэтапный контролируемый подход:

1. **CLIP** — извлечение структурных визуальных признаков;
2. **BLIP** — получение свободного описания визуальных деталей;
3. **LLM (Qwen 3B Instruct)** — формирование финального текста
   по строгому шаблону и ограничениям.

Модель:
- не использует не визуальные признаки (бренд, размер, доставка и т.п.);
- не добавляет домыслы;
- формирует нейтральный драфт карточки товара.

---

## Время выполнения и ресурсы

### Парсинг одного объявления
- загрузка HTML: ~10 секунд;
- парсинг и извлечение полей: ~10 секунд;
- загрузка изображений: ~2 секунды.

Итого: ~22 секунды на объявление  
(локальный запуск, без параллелизации и кэширования).

### ML-часть
- запуск второго ноутбука выполнялся на **Kaggle GPU (Tesla T4)**;
- полное выполнение ноутбука: ~25 минут.

---

## Окружение и запуск

- Python 3.11
- зависимости указаны в `requirements.txt`
- PyTorch устанавливается отдельно
  в зависимости от конфигурации CPU / CUDA

---

## Структура репозитория
<pre>
│   README.md
│   requirements.txt
│
├───data
│   ├───datasets
│   │       dataset_dress.jsonl
│   │       ...
│   │       dataset_trousers_woman.jsonl
│   │
│   ├───model
│   │       classifier.pt
│   │       label_encoders.pkl 
│   │  
│   └───links
│           links_dress.txt
│           ...
│           links_trousers_woman.txt
│
└───notebooks
        01_parser.ipynb
        02_pipeline.ipynb  
</pre>

---

## Запуск
Установить зависимости:
```bash
pip install -r requirements.txt
```
Проект тестировался в окружении Python 3.11, версии библиотек зафиксированы в `requirements.txt`.
PyTorch устанавливается отдельно в зависимости от конфигурации CPU/CUDA.

---

## Время выполнения и ресурсы

Оценка времени выполнения парсинга для одного объявления:

- загрузка HTML-страницы: ~10 секунд;
- парсинг HTML и извлечение полей: ~10 секунд;
- загрузка изображений объявления: ~2 секунды.

Итого: ~22 секунды на одно объявление.

Замеры получены при локальном запуске,
без параллелизации и без кэширования,
в стандартном пользовательском окружении.

Ноутбук с ML-частью запускался с KAGGLE GPU
Время работы ~25 минут, без учета скорости скачивания данных

---

## Ограничения текущей реализации

* парсер ориентирован на фиксированную структуру HTML-страниц;
* отсутствует полноценный автоматический сбор данных из сети;
* мультимодальная часть носит экспериментальный характер и не оптимизирована по качеству и производительности.
---

## План дальнейшей работы

* расширение датасета;
* формирование точной разметки для обучения моделей;
* развитие мультимодального автозаполнения других полей по изображениям;
* оценка качества моделей и оптимизация пайплайна.




